# HTTP 메세지

## 메세지의 흐름

- HTTP는 인바운드와 아웃바운드라는 용어를 트랝개션 방향을 표현하기 위해 사용한다.
- 메세지가 원 서버로 향하는 것은 인바운드로 이동하는 것이이다.
- 모든 처리가 끝난 뒤에 메시지가 사용자 에이전트로 돌아오는 것은 아웃바운드로 이동하는 것이다.

## 메시지의 각 부분

- HTTP 메시지는 단순한, 데이터의 구조화된 블록이다.
- 각 메시지는 클라이언트로부터의 요청이나 서버로부터의 응답 중 하나를 포함한다.
- 메시지는 시작줄, 헤더 블록, 본문 이렇게 세 부분으로 이루어진다.
- 시작줄은 이것이 어떤 메시지인지 서술한다. 줄 단위로 분리된 아스키 문자열이다.
  각 줄은 캐리지 리턴과 개행 문자로 구성된 두 글자의 줄바꿈 문자열로 끝난다. 이 줄바꿈 문자열은 CRLF라고 쓴다.
- 헤더 블록은 속성을 의미한다.
  Content-Type 줄은 본문이 무엇인지를 말해준다.
  Content-Length 줄은 본문의 크기를 말해준다.
- 본문은 데이터를 담고 있다. 엔티티 본문이나 메시지 본문은 단순히 선택적인 데이터 덩어리이다. 비어있을 수도 있다.

### 메시지 문법

요청 메시지의 형식은 다음과 같다.

```
<메서드> <요청 URL> <버전>
<헤더>

<엔티티 본문>
```

응답 메시지의 형식은 다음과 같다.

```
<버전> <상태 코드> <사유 구절>
<헤더>

<엔티티 본문>
```

#### 메서드

- 클라이언트 측에서 서버가 리소스에 대해 수행해주길 바라는 동작이다. 'GET', 'POST', 'PUT', 'DELETE' 등이 있다.

#### 요청 URL

- 요청 대상이 되는 리소스를 지칭하는 완전한 URL 혹은 URL의 경로 구성요소이다.

#### 버전

- 해당 메시지에서 사용 중인 HTTP의 버전이다.
- 형식은 다음과 같다. HTTP/`<메이저>`, `<마이너>`

#### 상태 코드

- 요청 중에 무엇이 일어났는지 설명하는 세 자리의 숫자다.
- 각 코드의 첫 번째 자릿 수는 상태의 일반적인 분류 ('성공', '에러')를 나타낸다.

#### 사유 구절

- 숫자로 된 상태 코드의 의미를 사람이 이해할 수 있게 설명해주는 짧은 문구이다.

#### 헤더들

- 이름, 콜론(:), 선택적인 공백, 값, CRLF가 순서대로 나타나는 0개 이상의 헤더들이며 헤더 목록의 끝과 엔티티 본문의 시작을 표시한다.

#### 엔티티 본문

- 임의의 데이터 블록을 포함한다.

- 모든 메시지가 엔티티 본문을 갖는 것은 아니다. 때때로 메세지는 CRLF로 끝나게 된다.

### 시작줄

- 모든 HTTP 메시지는 시작줄로 시작한다.
- 요청 메시지의 시작줄은 무엇을 해야 하는지 말해준다.
- 응답 메시지의 시작줄은 무슨 일이 일어났는지 말해준다.

#### 요청줄

- 요청 메시지는 서버에게 리소스에 대해 무언가를 해달라고 부탁한다.
- 요청 메시지의 시작줄, 혹은 요청줄에는 서버에서 어떤 동작이 일어나야 하는지 설명해주는 메서드와 그 동작에 대한 대상을 지칭하는 요청 URL이 들어있다.
- 또한 요청줄은 클라이언트가 어떤 HTTP 버전으로 말하고 있는지 서버에게 알려주는 HTTP 버전도 포함한다.

#### 응답줄

- 응답 메시지는 수행 결과에 대한 상태 정보와 결과 데이터를 클라이언트에게 돌려준다.

- 응답 메시지의 시작줄 혹은 응답줄에는 응답 메시지에서 쓰인 HTTP 버전, 숫자로 된 상태 코드, 수행 상태에 대해 설명해주는 텍스트로 된 사유 구절이 들어있다.

#### 메서드

- 요청의 시작줄은 메서드로 시작하며, 서버에게 무엇을 해야 하는지 말해준다.
- HTTP 명세는 공통 요청 메서드의 집합을 정의한다.
  다음은 많이 쓰이는 HTTP 메서드이다.

| 메서드  | 설명                                                    | 메시지 본문 |
| ------- | ------------------------------------------------------- | ----------- |
| GET     | 서버에서 어떤 데이터를 가져온다.                        | X           |
| HEAD    | 서버에서 어떤 데이터에 대해 헤더만 가져온다.            | X           |
| POST    | 서버가 처리해야 할 데이터를 보낸다.                     | O           |
| PUT     | 서버에 요청 데이터의 본문을 덮어씌운다.                 | O           |
| TRACE   | 메시지가 프락시를 거쳐 서버에 도달하는 과정을 추적한다. | X           |
| OPTIONS | 서버가 어떤 메서드를 수행할 수 있는지 확인한다.         | X           |
| DELETE  | 서버에서 데이터를 제거한다.                             | X           |

- 모든 서버가 해당 메서드를 모두 구현한 것은 아니다. 더 나아가 HTTP는 쉽게 확장할 수 있도록 설계되었다.
- 다른 서버에서는 그들만의 메서드를 추가로 구현했을 수도 있다. 이러한 추가 메서드를 확장 메서드라고 부른다.

#### 상태 코드

- 메서드가 서버에게 무엇을 해야 하는지 말해주는 것처럼, 상태 코드는 클라이언트에게 무엇이 일어났는지 말해준다.
- 상태 코드는 각 응답 메시지의 시작줄에 담겨 반환된다. 숫자로 된 코드와, 문자열로 되어 있어서 사람이 이해하기 쉬운 메시지 두 형태 모두로 반환된다.
- 상태 코드들은 세 자리 숫자로 된 코드값을 기준으로 묶인다.
  다음은 상태 코드의 종류이다.

| 전체 범위 | 정의된 범위 | 분류            |
| --------- | ----------- | --------------- |
| 100-199   | 100-101     | 정보            |
| 200-299   | 200-206     | 성공            |
| 300-399   | 300-305     | 리다이렉션      |
| 400-499   | 400-415     | 클라이언트 에러 |
| 500-599   | 500-505     | 서버 에러       |

- 다음은 가장 흔한 상태코드 및 숫자/문자열로 반환되는 상태 코드이다.

| 상태 코드 | 사유 구절    | 의미                                               |
| --------- | ------------ | -------------------------------------------------- |
| 200       | OK           | 성공. 요청한 모든 데이터는 응답 본문에 있다.       |
| 401       | Unauthorized | 사용자 이름과 비밀번호를 입력해야 한다.            |
| 404       | Not Found    | 서버는 요청한 URL에 해당하는 리소스를 찾지 못했다. |

#### 사유 구절

- 응답 시작줄의 마지막 구성요소다.
- 상태 코드에 대한 글로 된 설명을 제공한다.
- 사유 구절은 상태 코드와 일대일로 대응된다.
- 사유 구절은 애플리케이션 개발자들이 그들의 사용자에게 요청 중에 무슨 일이 일어났는지 알려주기 위해 넘겨줄 수 있는, 상태코드의 사람이 이해하기 쉬운 버전이다.

#### 버전 번호

- 버전 번호는 HTTP/x.y 형식으로 요청과 응답 메시지 양쪽 모두에 기술된다.

- HTTP 애플리케이션들이 자신이 따르는 프로토콜의 버전을 상대방에게 말해주기 위한 수단이 된다.

#### 헤더

- HTTP 헤더 필드는 요청과 응답 메시지에 추가 정보를 더한다.
- 기본적으로 이름/값 쌍의 목록이다.
  - 헤더 분류 - HTTP 헤더 명세는 여러 헤더 필드를 정의한다.
    애플리케이션은 또한 자유롭게 자신만의 헤더를 만들어낼 수 있다.
    - 일반 헤더 - 요청과 응답 양쪽에 모두 나타날 수 있음
    - 요청 헤더 - 요청에 대한 부가 정보를 제공
    - 응답 헤더 - 응답에 대한 부가 정보를 제공
    - Entity 헤더 - 본문 크기와 콘텐츠, 혹은 리소스 그 자체를 서술
    - 확장 헤더 - 명세에 정의되지 않은 새로운 헤더

### 엔티티 본문

- 데이터의 화물이라 할 수 있다. HTTP가 수송하도록 설계된 것들이다.
- HTTP 메시지는 이미지, 비디오, HTML 문서, 소프트웨어 애플리케이션, 신용카드 트랜잭션, 전자우편 등 여러 종류의 디지털 데이터를 실어 나를 수 있다.

## 메서드

### 안전한 메서드(Safe Method)

- HTTP는 안전한 메서드라 불리는 메서드의 집합을 정의한다.
- GET과 HEAD 메서드는 안전하다고 할 수 있는데, 이는 GET이나 HEAD 메서드를 사용하는 HTTP 요청의 결과로 서버에 어떤 작용도 없음을 의미한다.
- 작용이 없다는 것은, HTTP 요청의 결과로 인해 서버에 일어나는 일은 아무것도 없다는 의미이다.

#### GET

- 가장 흔히 쓰이는 메서드이다.
- 주로 서버에게 리소스를 달라고 요청하기 위해 쓰인다.

#### HEAD

- GET처럼 행동하지만 응답으로 헤더만을 돌려준다.
- 엔티티 본문은 반환되지 않는다.
- 리소스를 실제로 가져올 필요 없이 헤더만을 조사할 수 있도록 해준다.

#### PUT

- PUT 메서드는 서버에 데이터를 덮어씌울 수 있다.
- 이는 기존의 데이터를 변경할 때 주로 사용된다.

#### POST

- POST 메서드는 서버에 입력 데이터를 전송하기 위해 설계되었다.
- 주로 폼에 데이터를 담아서 서버에 요청을 보낼 때 사용된다.

#### OPTIONS

- 서버에게 특정 리소스에 대해 어떤 메서드가 지원되는지 물어볼 수 있다.
- 실제로 리소스에 접근하지 않고도 어떻게 접근하면 최선인지 확인할 수 있다.

#### DELETE

- 서버에게 요청한 URL로 지저한 리소스를 삭제할 것을 요청한다.

### 상태 코드

- HTTP 상태 코드는 클라이언트에게 그들의 트랜잭션을 이해할 수 있는 쉬운 방법을 제공한다.

#### 100-199: 정보성 상태 코드

- 클라이언트의 요청이 서버에 성공적으로 전달되었고, 서버가 이 요청을 계속해서 처리하고 있음을 알리는 중간 응답이다.
- 최종적인 성공이나 실패를 나타내는 것이 아니라 요청 처리 과정의 중간 상태를 알려주는 역할을 한다.
- 주로 데이터를 전송중인지 확인하기 위해 요청되며 '로딩중'을 표시하기 위해 사용할 수 있다.

#### 200-299: 성공 상태 코드

- 클라이언트가 서버에 요청을 보냈을 때 성공했음을 의미한다.

| 상태 코드 | 사유 구절                     | 의미                                                                |
| --------- | ----------------------------- | ------------------------------------------------------------------- |
| 200       | OK                            | 요청 정상, 엔티티 본문에 데이터 포함                                |
| 201       | Created                       | 서버에서 개체를 생성 성공하였음을 의미                              |
| 202       | Accepted                      | 요청을 받아들여졌으나 서버에서 특정 동작은 하지 않음                |
| 203       | Non-Authoritative Information | 엔티티에 있는 정보가 원래 서버가 아닌 중개자로부터 가져옴           |
| 204       | No Content                    | 응답 메시지와 헤더는 포함하지만 엔티티 본문은 미포함                |
| 205       | Reset Content                 | 브라우저에게 현재 페이지에 있는 HTML 폼에 채워진 값을 비우라고 알림 |
| 206       | Partial Content               | 부분 혹은 범위 요청 성공                                            |

#### 300-399: 리다이렉션 상태 코드

- 클라이언트가 서버로 요청을 한 후 서버가 다시 클라이언트에게 다른 위치로 이동할 새로운 주소를 알려주고 그곳으로 자동으로 이동시키는 역할이다.

| 상태 코드 | 사유 구절         | 의미                                                                                                     |
| --------- | ----------------- | -------------------------------------------------------------------------------------------------------- |
| 300       | Multiple Choices  | 서버가 클라이언트에게 이동할 여러 주소를 제공, 클라이언트는 그 주소중 하나를 선택하여 페이지를 이동한다. |
| 301       | Moved Permanently | 서버가 요청한 웹 페이지의 주소로 이동                                                                    |
| 302       | Found             | 서버가 요청한 웹 페이지의 주소로 임시 이동 후 원래 주소로 다시 접속 시도                                 |
| 303       | See Other         | 요청한 작업이 성공했으며, 이동할 주소를 알려줌                                                           |
| 304       | Not Modified      | 변경할 사항 없음                                                                                         |

#### 400~499: 클라이언트 에러 상태 코드

- 클라이언트가 서버로 잘못된 요청을 보냈을 때 발생하는 에러 코드이다.
- 서버는 정상적으로 작동하고 있지만, 클라이언트 측으로부터 받은 요청이 비정상적이어서 처리할 수 없는 상태

| 상태 코드 | 사유 구절          | 의미                                                                      |
| --------- | ------------------ | ------------------------------------------------------------------------- |
| 400       | Bad Request        | 클라이언트가 잘못된 요청을 보냄                                           |
| 401       | Unauthorized       | 리소스를 얻기 전에 클라이언트에게 스스로를 인증하라고 요구를 보냄         |
| 403       | Forbbidden         | 요청이 서버에 의해 거부되었음, 서버에서의 거부 이유를 숨기고 싶을 때 사용 |
| 404       | Not Found          | 클라이언트가 요청한 페이지나 리소스를 서버에서 찾을 수 없음               |
| 405       | Method Not Allowed | 지원하지 않는 메서드를 요청받았을 때 잘못된 요청을 보냈다고 알림          |

#### 500-599: 서버 에러 상태 코드

- 클라이언트가 올바른 요청을 보냈음에도 서버 자체에서 에러가 발생하는 에러 코드이다.

| 상태 코드 | 사유 구절             | 의미                                                    |
| --------- | --------------------- | ------------------------------------------------------- |
| 500       | Internal Server Error | 서버가 클라이언트의 요청을 처리할 수 없을 때 발생       |
| 501       | Not Implemented       | 서버가 클라이언트가 요청한 기능을 지원하지 않을 때 발생 |
| 502       | Bad Gateway           | 서버간의 통신 과정에서 문제가 발생                      |
| 503       | Service Unavailable   | 서버가 요청을 지금 처리 못해주고 나중에 가능할 때 발생  |
| 504       | Gateway Timeout       | 서버에게 요청을 보내고 응답을 기다리다 타임아웃이 발생  |
